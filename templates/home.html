<!DOCTYPE html>
<html>
<head>
    <title>Smart Investment Advisor</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background-color: #0f172a;
            color: white;
        }

        .container {
            width: 85%;
            margin: 40px auto;
        }

        h1 {
            text-align: center;
        }

        .form-section {
            text-align: center;
            margin: 30px 0;
        }

        select, button {
            padding: 10px;
            font-size: 16px;
            border-radius: 5px;
            border: none;
        }

        button {
            background: #2563eb;
            color: white;
            cursor: pointer;
        }

        .cards {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 30px;
        }

        .card {
            flex: 1 1 200px;
            background: #1e293b;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .recommendation {
            text-align: center;
            font-size: 22px;
            margin-top: 25px;
            font-weight: bold;
        }

        .buy { color: #22c55e; }
        .avoid { color: #ef4444; }
        .hold { color: #facc15; }

        canvas {
            margin-top: 40px;
            background: #1e293b;
            padding: 20px;
            border-radius: 10px;
        }

        .low { color: #22c55e; font-weight: bold; }
        .moderate { color: #facc15; font-weight: bold; }
        .high { color: #ef4444; font-weight: bold; }

        .rsi-high { color: #ef4444; }
        .rsi-low { color: #22c55e; }
        .rsi-neutral { color: #facc15; }
    </style>
</head>

<body>

<div class="container">

    <h1>Smart Investment Advisor</h1>

    <!-- FORM -->
    <div class="form-section">
        <form method="POST" action="/analyze">

            <select name="stock" required>
                {% for stock in stocks %}
                    <option value="{{ stock }}"
                        {% if result and stock == result.stock %}selected{% endif %}>
                        {{ stock }}
                    </option>
                {% endfor %}
            </select>

            <select name="range">
                <option value="1M" {% if selected_range == "1M" %}selected{% endif %}>1 Month</option>
                <option value="3M" {% if selected_range == "3M" %}selected{% endif %}>3 Months</option>
                <option value="6M" {% if selected_range == "6M" %}selected{% endif %}>6 Months</option>
                <option value="1Y" {% if selected_range == "1Y" %}selected{% endif %}>1 Year</option>
                <option value="ALL" {% if selected_range == "ALL" %}selected{% endif %}>All</option>
            </select>

            <button type="submit">Analyze</button>

        </form>
    </div>

    {% if result %}

    <!-- METRIC CARDS -->
    <div class="cards">

        <div class="card">
            <h3>Volatility</h3>
            <p>{{ result.volatility }}</p>
        </div>

        <div class="card">
            <h3>Average Return</h3>
            <p>{{ result.avg_return }}</p>
        </div>

        <div class="card">
            <h3>Trend</h3>
            <p>{{ result.trend }}</p>
        </div>

        <div class="card">
            <h3>Score</h3>
            <p>{{ result.score }}</p>
        </div>

        {% set risk_class = result.risk_level | lower %}
        <div class="card">
            <h3>Risk Level</h3>
            <p class="{{ risk_class }}">{{ result.risk_level }}</p>
        </div>

        {% if result.rsi > 70 %}
            {% set rsi_class = "rsi-high" %}
        {% elif result.rsi < 30 %}
            {% set rsi_class = "rsi-low" %}
        {% else %}
            {% set rsi_class = "rsi-neutral" %}
        {% endif %}

        <div class="card">
            <h3>RSI</h3>
            <p class="{{ rsi_class }}">{{ result.rsi }}</p>
        </div>

        <div class="card">
            <h3>Next Day Prediction</h3>
            <p>{{ result.prediction }}</p>
        </div>

        <div class="card">
            <h3>MAE</h3>
            <p>{{ result.mae }}</p>
        </div>

        <div class="card">
            <h3>RÂ² Score</h3>
            <p>{{ result.r2 }}</p>
        </div>

    </div>

    {% set rec_class = "hold" %}
    {% if "Buy" in result.recommendation %}
        {% set rec_class = "buy" %}
    {% elif "Avoid" in result.recommendation %}
        {% set rec_class = "avoid" %}
    {% endif %}

    <div class="recommendation {{ rec_class }}">
        Recommendation: {{ result.recommendation }}
    </div>

    <!-- STOCK CHART -->
    {% if chart_data %}
    <canvas id="stockChart"></canvas>

    <script>
    const chartData = {{ chart_data | tojson | safe }};

    new Chart(document.getElementById('stockChart'), {
        type: 'line',
        data: {
            labels: chartData.dates,
            datasets: [
                {
                    label: 'Close',
                    data: chartData.close,
                    borderColor: '#38bdf8',
                    borderWidth: 2,
                    pointRadius: 0,
                    tension: 0.3
                },
                {
                    label: 'MA20',
                    data: chartData.ma20,
                    borderColor: '#22c55e',
                    borderWidth: 2,
                    pointRadius: 0,
                    tension: 0.3
                },
                {
                    label: 'MA50',
                    data: chartData.ma50,
                    borderColor: '#f97316',
                    borderWidth: 2,
                    pointRadius: 0,
                    tension: 0.3
                }
            ]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { labels: { color: 'white' } }
            },
            scales: {
                x: { ticks: { color: 'white', maxTicksLimit: 8 } },
                y: { ticks: { color: 'white' } }
            }
        }
    });
    </script>
    {% endif %}

    <!-- PREDICTION CHART -->
    {% if prediction_chart %}
    <canvas id="predictionChart"></canvas>

    <script>
    const predData = {{ prediction_chart | tojson | safe }};

    new Chart(document.getElementById('predictionChart'), {
        type: 'line',
        data: {
            labels: predData.actual.map((_, i) => i),
            datasets: [
                {
                    label: 'Actual',
                    data: predData.actual,
                    borderColor: '#38bdf8',
                    borderWidth: 2,
                    pointRadius: 0
                },
                {
                    label: 'Predicted',
                    data: predData.predicted,
                    borderColor: '#ef4444',
                    borderWidth: 2,
                    pointRadius: 0
                }
            ]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { labels: { color: 'white' } }
            },
            scales: {
                x: { ticks: { color: 'white' } },
                y: { ticks: { color: 'white' } }
            }
        }
    });
    </script>
    {% endif %}

    {% endif %}

</div>

</body>
</html>